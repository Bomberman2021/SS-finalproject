{"version":3,"sources":["UserInfo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// declare const firebase: any;\r\n\r\nconst {ccclass, property} = cc._decorator;\r\nlet record = null;\r\n\r\n@ccclass\r\nexport class UserInfo extends cc.Component {\r\n\r\n  @property(cc.Label)\r\n  userName: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userLevel: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userCoin: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  currentPlayer: cc.Label = null;\r\n\r\n  public userId: String = '';\r\n\r\n  public skinCategory: string[] = \r\n    ['normal', 'boxer', 'brucelee', 'bullman', 'caveman',\r\n     'ebifry', 'egypt', 'mexican', 'ninja', 'pirate', 'russian']; // 全11種\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad () {\r\n    record = cc.find(\"record\").getComponent(\"record\");\r\n    \r\n    if (!record.currentPlayer) {\r\n      this.defaultStyle();\r\n    }\r\n    \r\n    const user = firebase.auth().currentUser;\r\n    if (user) {\r\n      this.getUserRecord(user.uid);\r\n      this.userId = user.uid;\r\n    } else {\r\n      console.log('沒登入');\r\n      if (!record.currentPlayer) { \r\n        this.testData();\r\n      }\r\n    }\r\n    \r\n    if (this.currentPlayer) {\r\n      this.currentPlayer.string = record.currentPlayer;\r\n      console.log('currentPlayer:',record.currentPlayer);\r\n    }    \r\n\r\n    if (cc.find(`Canvas/Player1/Character/normal`)) {\r\n      cc.find(`Canvas/Player1/Character/normal`).active = false; // 先把預設圖拿掉\r\n      let player1Style = cc.find(`Canvas/Player1/Character/${this.skinCategory[record.player1Skin]}`);\r\n      player1Style.active = true;\r\n      player1Style.getChildByName(record.player1Color).active = true;\r\n      \r\n      cc.find(`Canvas/Player2/Character/normal`).active = false; // 先把預設圖拿掉\r\n      let player2Style = cc.find(`Canvas/Player2/Character/${this.skinCategory[record.player2Skin]}`);\r\n      player2Style.active = true;\r\n      player2Style.getChildByName(record.player2Color).active = true;\r\n    }\r\n  }\r\n\r\n  // start () {}\r\n\r\n  testData() {\r\n    record.userSkinCategory = [0, 2, 8];\r\n    record.userBombCategory = [0, 2];\r\n  }\r\n\r\n  defaultStyle() {\r\n    record.player1Skin = 0;\r\n    record.player1Bomb = 0;\r\n    record.player1Color = 'black';\r\n\r\n    record.player2Skin = 0;\r\n    record.player2Bomb = 0;\r\n    record.player2Color = 'black';\r\n\r\n    record.settingLife = '1';\r\n    record.settingTime = '60';\r\n  }\r\n\r\n  getUserRecord(userId) {\r\n    // 取基本資料\r\n    const playersInfo = `/players/playerInfo-${userId}`;\r\n    firebase.database().ref(playersInfo).once('value')\r\n    .then((snapshot) => {\r\n      // console.log('snapshot.val():', snapshot.val());\r\n      const theData = snapshot.val();\r\n\r\n      if(this.userName&&this.userLevel&&this.userCoin){\r\n        this.userName.string = theData.name.toUpperCase();\r\n        this.userLevel.string = theData.level;\r\n        this.userCoin.string = theData.coin;\r\n      }\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n    // 取userSkin List\r\n    let userSkinCategory = [];\r\n    const playersUserSkin =`/players/playerInfo-${userId}/userSkin`;\r\n    firebase.database().ref(playersUserSkin).once('value')\r\n    .then((snapshot) => {\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        userSkinCategory.push(chiledData.index);\r\n      });\r\n      record.userSkinCategory = userSkinCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n    // 取bombSkin List\r\n    let userBombCategory = [];\r\n    const playersBombSkin =`/players/playerInfo-${userId}/bombSkin`;\r\n    firebase.database().ref(playersBombSkin).once('value')\r\n    .then((snapshot) => {\r\n      const theData = snapshot.val();\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        userBombCategory.push(chiledData.index);\r\n      });\r\n      record.userBombCategory = userBombCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n  }\r\n\r\n  // update (dt) {}\r\n}\r\n"]}