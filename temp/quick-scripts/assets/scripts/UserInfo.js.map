{"version":3,"sources":["UserInfo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// declare const firebase: any;\r\n\r\nconst {ccclass, property} = cc._decorator;\r\nlet record = null;\r\n\r\n@ccclass\r\nexport class UserInfo extends cc.Component {\r\n\r\n  @property(cc.Label)\r\n  userName: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userLevel: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userCoin: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  currentPlayer: cc.Label = null;\r\n\r\n  public userId: String = '';\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad () {\r\n    record = cc.find(\"record\").getComponent(\"record\");\r\n    \r\n    const user = firebase.auth().currentUser;\r\n    if (user) {\r\n      this.getUserRecord(user.uid);\r\n      this.userId = user.uid;\r\n    } else {\r\n      console.log('沒登入');\r\n    }\r\n    \r\n    if (this.currentPlayer) {\r\n      this.currentPlayer.string = record.currentPlayer;\r\n      console.log('currentPlayer:',record.currentPlayer);\r\n    }\r\n  }\r\n\r\n  start () {\r\n  }\r\n\r\n  getUserRecord(userId) {\r\n    // 取基本資料\r\n    const playersInfo = `/players/playerInfo-${userId}`;\r\n    firebase.database().ref(playersInfo).once('value')\r\n    .then((snapshot) => {\r\n      // console.log('snapshot.val():', snapshot.val());\r\n      const theData = snapshot.val();\r\n\r\n      if(this.userName&&this.userLevel&&this.userCoin){\r\n        this.userName.string = theData.name.toUpperCase();\r\n        this.userLevel.string = theData.level;\r\n        this.userCoin.string = theData.coin;\r\n      }\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n    // 取userSkin List\r\n    let userSkinCategory = [];\r\n    const playersUserSkin =`/players/playerInfo-${userId}/userSkin`;\r\n    firebase.database().ref(playersUserSkin).once('value')\r\n    .then((snapshot) => {\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        userSkinCategory.push(chiledData.index);\r\n      });\r\n      record.userSkinCategory = userSkinCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n    // 取bombSkin List\r\n    let userBombCategory = [];\r\n    const playersBombSkin =`/players/playerInfo-${userId}/bombSkin`;\r\n    firebase.database().ref(playersBombSkin).once('value')\r\n    .then((snapshot) => {\r\n      const theData = snapshot.val();\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        userBombCategory.push(chiledData.index);\r\n      });\r\n      record.userBombCategory = userBombCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n  }\r\n\r\n  // update (dt) {}\r\n}\r\n"]}