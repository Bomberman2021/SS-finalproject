{"version":3,"sources":["UserInfo.ts"],"names":[],"mappings":";;;;AAAA,6CAA6C;;AAEvC,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAG1C;IAA8B,4BAAY;IAD1C;QAAA,qEA2FC;QAvFC,cAAQ,GAAa,IAAI,CAAC;QAG1B,eAAS,GAAa,IAAI,CAAC;QAG3B,cAAQ,GAAa,IAAI,CAAC;QAG1B,mBAAa,GAAa,IAAI,CAAC;QAExB,YAAM,GAAW,EAAE,CAAC;QAEpB,sBAAgB,GAAa,EAAE,CAAC;QAChC,sBAAgB,GAAa,EAAE,CAAC;;QAwEvC,iBAAiB;IACnB,CAAC;IAvEC,wBAAwB;IAExB,yBAAM,GAAN;QACE,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC;QACzC,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC;SACxB;aAAM;YACL,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;SACzB;QAED,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,IAAI,CAAC,aAAa,CAAC,MAAM,GAAI,MAAc,CAAC,aAAa,CAAC;YAC1D,OAAO,CAAC,GAAG,CAAC,SAAS,EAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;SAClD;IACH,CAAC;IAED,wBAAK,GAAL;IACA,CAAC;IAED,gCAAa,GAAb,UAAc,MAAM;QAApB,iBA4CC;QA3CC,QAAQ;QACR,IAAM,WAAW,GAAG,yBAAuB,MAAQ,CAAC;QACpD,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;aACjD,IAAI,CAAC,UAAC,QAAQ;YACb,kDAAkD;YAElD,IAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAE/B,IAAG,KAAI,CAAC,QAAQ,IAAE,KAAI,CAAC,SAAS,IAAE,KAAI,CAAC,QAAQ,EAAC;gBAC9C,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;gBAClD,KAAI,CAAC,SAAS,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC;gBACtC,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC;aACrC;QACH,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,CAAC,IAAK,OAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,EAAxB,CAAwB,CAAC,CAAC;QAGxC,iBAAiB;QACjB,IAAM,eAAe,GAAE,yBAAuB,MAAM,cAAW,CAAC;QAChE,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;aACrD,IAAI,CAAC,UAAC,QAAQ;YACb,QAAQ,CAAC,OAAO,CAAC,UAAA,IAAI;gBACnB,IAAM,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBAC9B,KAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;YACH,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,KAAI,CAAC,gBAAgB,CAAC,CAAC;YAChD,MAAc,CAAC,gBAAgB,GAAG,KAAI,CAAC,gBAAgB,CAAC;QAC3D,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,CAAC,IAAK,OAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,EAAxB,CAAwB,CAAC,CAAC;QAExC,iBAAiB;QACjB,IAAM,eAAe,GAAE,yBAAuB,MAAM,cAAW,CAAC;QAChE,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;aACrD,IAAI,CAAC,UAAC,QAAQ;YACb,IAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAC/B,QAAQ,CAAC,OAAO,CAAC,UAAA,IAAI;gBACnB,IAAM,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBAC9B,KAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;YACH,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,KAAI,CAAC,gBAAgB,CAAC,CAAC;YAChD,MAAc,CAAC,gBAAgB,GAAG,KAAI,CAAC,gBAAgB,CAAC;QAC3D,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,CAAC,IAAK,OAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,EAAxB,CAAwB,CAAC,CAAC;IAC1C,CAAC;IAhFD;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;8CACO;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;+CACQ;IAG3B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;8CACO;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;mDACY;IAZpB,QAAQ;QADpB,OAAO;OACK,QAAQ,CA0FpB;IAAD,eAAC;CA1FD,AA0FC,CA1F6B,EAAE,CAAC,SAAS,GA0FzC;AA1FY,4BAAQ","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// import LoadSceneBtn from \"./LoadSceneBtn\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport class UserInfo extends cc.Component {\r\n\r\n  @property(cc.Label)\r\n  userName: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userLevel: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  userCoin: cc.Label = null;\r\n\r\n  @property(cc.Label)\r\n  currentPlayer: cc.Label = null;\r\n\r\n  public userId: String = '';\r\n\r\n  public userSkinCategory: string[] = []; \r\n  public userBombCategory: string[] = [];\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad () {\r\n    const user = firebase.auth().currentUser;\r\n    if (user) {\r\n      this.getUserRecord(user.uid);\r\n      this.userId = user.uid;\r\n    } else {\r\n      console.log('不對不對喔沒登入');\r\n    }\r\n    \r\n    if (this.currentPlayer) { \r\n      this.currentPlayer.string = (window as any).currentPlayer;\r\n      console.log('player:',this.currentPlayer.string);\r\n    }\r\n  }\r\n\r\n  start () {\r\n  }\r\n\r\n  getUserRecord(userId) {\r\n    // 取基本資料\r\n    const playersInfo = `/players/playerInfo-${userId}`;\r\n    firebase.database().ref(playersInfo).once('value')\r\n    .then((snapshot) => {\r\n      // console.log('snapshot.val():', snapshot.val());\r\n      \r\n      const theData = snapshot.val();\r\n\r\n      if(this.userName&&this.userLevel&&this.userCoin){\r\n        this.userName.string = theData.name.toUpperCase();\r\n        this.userLevel.string = theData.level;\r\n        this.userCoin.string = theData.coin;\r\n      }\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n\r\n    // 取userSkin List\r\n    const playersUserSkin =`/players/playerInfo-${userId}/userSkin`;\r\n    firebase.database().ref(playersUserSkin).once('value')\r\n    .then((snapshot) => {\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        this.userSkinCategory.push(chiledData.index);\r\n      });\r\n      console.log('skinArray:', this.userSkinCategory);\r\n      (window as any).userSkinCategory = this.userSkinCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n\r\n    // 取bombSkin List\r\n    const playersBombSkin =`/players/playerInfo-${userId}/bombSkin`;\r\n    firebase.database().ref(playersBombSkin).once('value')\r\n    .then((snapshot) => {\r\n      const theData = snapshot.val();\r\n      snapshot.forEach(item => {\r\n        const chiledData = item.val();\r\n        this.userBombCategory.push(chiledData.index);\r\n      });\r\n      console.log('bombArray:', this.userBombCategory);\r\n      (window as any).userBombCategory = this.userBombCategory;\r\n    })\r\n    .catch((e) => console.error(e.message));\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  // update (dt) {}\r\n}\r\n"]}